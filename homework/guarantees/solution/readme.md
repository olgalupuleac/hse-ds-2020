# Решение 
## `Sender`
В методе `run` берётся следующая команда для обработки. Оно получается либо при помощи `_comm.recv_local()`, либо из очереди, в которую складываются локальные сообщения (если они были получены в процессе обработки других сообщений).
```python
 if self._command_queue:
    msg = self._command_queue[0]
    self._command_queue.pop(0)
else:
    msg = self._comm.recv_local()
    self._process_message(msg)
```
Далее сообщение обрабатывается при помощи метода `_process_message`. Там в зависимости от типа сообщения происходит следующее:
#### INFO-1
Сообщение просто отправляется `receiver`'у.

#### INFO-2
Вызывается метод `_send_at_least_once`. Он отвечает за то, чтобы сообщение было отправлено. В нём происходит следующее:
1. Сообщение отправляется `receiver`'у.
2. Мы конструируем ответ, который должен быть получен от `receiver` как подтверждение того, что ответ получен. Оно должно быть таким же, как исходное, только адрес отправителя должен быть изменён. 
3. Мы ждём ответа с таймаутом 1.
4. Если полученное сообщение -- это локальное сообщение, мы его обрабатываем. 
5. Другие сообщения кладутся в `_ok_responses`, где хранятся ответы от `receiver`.
6. Дальше мы проверяем, нет ли ожидаемого сообщения в `_ok_responses`, если нет, то возращаемся к пункту 1.

Одним из параметров `_send_at_least_once` является функция, которая обрабатывает локальные сообщения. В данном случае мы просто вызываем на нём `_process_message` (и таким образом порядок может не сохраняться).

#### INFO-3 
Происходит всё то же самое, что в `INFO-2` (с точки зрения `sender`).

#### INFO-4
Вызывается метод `_send_at_least_once`, но в этом случае все полученные локальные сообщения складываются в очередь и обрабатываются позже в методе `run`, в том же порядке, в котором они были получены. 

## `Receiver`
В зависимости от типа сообщения происходит следующее:
#### INFO-1
Мы храним полученные сообщения `_received_messages`, если нам приходит сообщение, которого раньше не было, мы добавляем его в полученные и отправляем локально, если такое сообщение было раньше, то ничего не делаем.
#### INFO-2
Мы получаем сообщение и отправляем обратно `sender`'у то же сообщение.
#### INFO-3
Мы храним полученные сообщения `_received_messages`, если нам приходит сообщение, которого раньше не было, мы добавляем его в полученные и отправляем локально. Также мы отправляем `sender`'у в ответ то же сообщение вне зависимости от того, было такое сообщение или не было. 

#### INFO-4
То же самое, что для `INFO-3` (с точки зрения `receiver`'а).

## Общие комментарии
Иногда, когда я запускаю тесты с `-n 100`, у меня не успевает стартовать сервер. Кажется, это какая-то глобальная проблема, которая не зависит от алгоритма. Воспроизводится не всегда. 
